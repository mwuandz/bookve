<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BookVe - Đặt chỗ ngồi trực tuyến</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <style>
        .seat {
            transition: all 0.3s ease;
        }
        .seat:hover {
            transform: scale(1.1);
        }
        .screen {
            background: linear-gradient(to bottom, rgba(255,255,255,0.2), rgba(255,255,255,0.05));
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }
        .selected {
            background-color: #3b82f6 !important;
            color: white !important;
        }
        .booked {
            background-color: #ef4444 !important;
            color: white !important;
            cursor: not-allowed;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <div id="vanta-bg" class="fixed inset-0 -z-10"></div>
    
    <header class="py-6 px-4 md:px-8 bg-gray-900 bg-opacity-80 backdrop-blur-sm">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl md:text-3xl font-bold text-blue-400 flex items-center">
                <i data-feather="film" class="mr-2"></i> BookVe By Minh Wuan
            </h1>
            <nav class="hidden md:flex space-x-6">
                <a href="#" class="hover:text-blue-400 transition">Trang chủ</a>
                <a href="#" class="hover:text-blue-400 transition">Phim</a>
                <a href="#" class="hover:text-blue-400 transition">Rạp</a>
                <a href="#" class="hover:text-blue-400 transition">Khuyến mãi</a>
                <a href="#" class="hover:text-blue-400 transition">Liên hệ</a>
            </nav>
            <button class="md:hidden">
                <i data-feather="menu"></i>
            </button>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <div class="bg-gray-800 bg-opacity-80 rounded-xl p-6 backdrop-blur-sm">
            <div class="flex flex-col md:flex-row gap-8">
                <div class="md:w-1/3">
                    <div class="sticky top-24">
                        <div class="bg-gray-700 rounded-lg p-6 mb-6">
                            <h2 class="text-xl font-bold mb-4">Thông tin phim</h2>
                            <div class="flex items-start mb-4">
                                <img src="https://image-worker.momocdn.net/img/87791512525791828-luudanh.png?size=M&referer=cinema.momocdn.net" alt="Movie Poster" class="w-20 h-28 rounded-lg object-cover mr-4">
                                <div>
                                    <h3 class="font-bold">Mưa Đỏ</h3>
                                    <p class="text-gray-400 text-sm">2h 30m • 16+</p>
                                    <div class="flex mt-2">
                                        <span class="bg-yellow-500 text-black text-xs px-2 py-1 rounded mr-2">2D</span>
                                        <span class="bg-purple-600 text-white text-xs px-2 py-1 rounded">Phụ đề</span>
                                    </div>
                                </div>
                            </div>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Rạp:</span>
                                    <span class="font-medium">Lotte Thanh Hóa</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Ngày:</span>
                                    <span class="font-medium">14/09/2025</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Suất:</span>
                                    <span class="font-medium">14:15</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Phòng:</span>
                                    <span class="font-medium">Cinema 3</span>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gray-700 rounded-lg p-6">
                            <h2 class="text-xl font-bold mb-4">Ghế đã chọn</h2>
                            <div class="mb-4">
                                <label for="customer-name" class="block text-sm font-medium text-gray-300 mb-2">Tên người đặt</label>
                                <input type="text" id="customer-name" class="w-full bg-gray-600 border border-gray-500 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div id="selected-seats" class="space-y-2 mb-4">
                                <!-- Selected seats will appear here -->
                            </div>
                            <div class="mt-6">
                                <h3 class="font-bold mb-2">Danh sách đã đặt</h3>
                                <div id="booked-list" class="space-y-2 text-sm">
                                    <!-- Booked seats list will appear here -->
                                </div>
                            </div>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Tổng cộng:</span>
                                    <span id="total-price" class="font-bold text-lg">0 VND</span>
                                </div>
                                <button id="checkout-btn" class="w-full bg-blue-600 hover:bg-blue-700 py-3 rounded-lg font-bold transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                    Thanh toán
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="md:w-2/3">
                    <div class="screen w-full h-8 md:h-12 mb-8 rounded-md mx-auto text-center text-gray-300 font-medium flex items-center justify-center">
                        MÀN HÌNH
                    </div>

                    <div class="grid grid-cols-10 gap-2 md:gap-4 mb-8" id="seats-container">
                        <!-- Seats will be generated here -->
                    </div>

                    <div class="flex flex-wrap justify-center gap-4 md:gap-8 mb-8">
                        <div class="flex items-center">
                            <div class="w-6 h-6 rounded bg-gray-600 mr-2"></div>
                            <span class="text-sm">Có thể chọn</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-6 h-6 rounded bg-blue-600 mr-2"></div>
                            <span class="text-sm">Đã chọn</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-6 h-6 rounded bg-red-500 mr-2"></div>
                            <span class="text-sm">Đã bán</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-6 h-6 rounded bg-yellow-500 mr-2"></div>
                            <span class="text-sm">VIP (D-J)</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-gray-900 bg-opacity-90 py-8 mt-12">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-xl font-bold text-blue-400 mb-4">BookVe by Minh Wuan</h3>
                    <p class="text-gray-400">Hệ thống đặt vé xem phim trực tuyến hàng đầu Việt Nam được vận hành bởi Đoàn Minh Quân.</p>
                </div>
                <div>
                    <h4 class="font-bold mb-4">Liên kết</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-blue-400 transition">Về chúng tôi</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-blue-400 transition">Điều khoản</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-blue-400 transition">Chính sách</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold mb-4">Hỗ trợ</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-blue-400 transition">Câu hỏi thường gặp</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-blue-400 transition">Hướng dẫn đặt vé</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-blue-400 transition">Liên hệ</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold mb-4">Kết nối</h4>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-blue-400 transition"><i data-feather="facebook"></i></a>
                        <a href="#" class="text-gray-400 hover:text-blue-400 transition"><i data-feather="instagram"></i></a>
                        <a href="#" class="text-gray-400 hover:text-blue-400 transition"><i data-feather="twitter"></i></a>
                        <a href="#" class="text-gray-400 hover:text-blue-400 transition"><i data-feather="youtube"></i></a>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-500">
                <p>© 2025 Đoàn Minh Quân. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Add Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.globe.min.js"></script>
    <script>
        // Initialize Vanta.js background
        VANTA.GLOBE({
            el: "#vanta-bg",
            mouseControls: true,
            touchControls: true,
            gyroControls: false,
            minHeight: 200.00,
            minWidth: 200.00,
            scale: 1.00,
            scaleMobile: 1.00,
            color: 0x3b82f6,
            backgroundColor: 0x111827,
            size: 0.8
        });

        // Initialize AOS
        AOS.init();

        // Generate seats
        const seatsContainer = document.getElementById('seats-container');
        const selectedSeatsContainer = document.getElementById('selected-seats');
        const totalPriceElement = document.getElementById('total-price');
        const checkoutBtn = document.getElementById('checkout-btn');

        let selectedSeats = [];
        const seatPrices = {
            normal: 58000,
            vip: 58000
        };
        let bookedSeats = [];
        let bookings = [];

        // Generate seat layout
        function generateSeats() {
            let html = '';
            const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
            // Get booked seats from localStorage
            const bookedSeats = [];
            
            // Add walkway after row C
            html += `
                <div class="col-span-10 h-8 my-4 flex items-center justify-center">
                    <div class="w-full border-t-2 border-dashed border-gray-600"></div>
                </div>
            `;

            rows.forEach(row => {
                // Add row indicator
                html += `<div class="col-span-10 text-center text-gray-400 font-medium mb-2">${row}</div>`;
                
                const isVipRow = ['D','E','F','G','H','I','J'].includes(row);
                const maxSeats = ['I','J'].includes(row) ? 11 : 9;
                let seatsInRow = 0;
                
                for (let i = 1; i <= maxSeats; i++) {
                    // Skip seats 6-7 in row J
                    if (row === 'J' && (i === 6 || i === 7)) continue;
                    
                    const seatId = `${row}${i}`;
                    let seatClass = isVipRow ? 'bg-yellow-500 hover:bg-yellow-400' : 'bg-gray-600 hover:bg-gray-500';
                    let disabled = false;
                    
                    if (bookedSeats.includes(seatId)) {
                        seatClass = 'bg-red-500 cursor-not-allowed';
                        disabled = true;
                    }
                    
                    // Special handling for I and J rows (seats 10-11)
                    if ((row === 'I' || row === 'J') && i >= 10) {
                        // Add empty space before seats 10-11
                        html += `<div class="col-span-${row === 'I' ? 1 : 2}"></div>`;
                    }
                    
                    html += `
                        <div 
                            class="seat w-full aspect-square rounded flex items-center justify-center text-xs font-bold ${seatClass} ${disabled ? 'booked' : ''}" 
                            data-seat="${seatId}"
                            data-type="${isVipRow ? 'vip' : 'normal'}"
                            ${disabled ? 'disabled' : ''}
                        >
                            ${i}
                        </div>
                    `;
                    seatsInRow++;
                }
                
                // Add empty columns to maintain grid alignment
                if (row === 'I' || row === 'J') {
                    const emptyCols = row === 'I' ? 10 - seatsInRow : 10 - seatsInRow - 1;
                    if (emptyCols > 0) {
                        html += `<div class="col-span-${emptyCols}"></div>`;
                    }
                }
            });
            
            seatsContainer.innerHTML = html;
            
            // Add event listeners to seats
            document.querySelectorAll('.seat:not(.booked)').forEach(seat => {
                seat.addEventListener('click', toggleSeatSelection);
            });
        }

        // Toggle seat selection
        function toggleSeatSelection(e) {
            const seatElement = e.currentTarget;
            const seatId = seatElement.dataset.seat;
            const seatType = seatElement.dataset.type;
            
            // If already selected, deselect it
            if (seatElement.classList.contains('selected')) {
                seatElement.classList.remove('selected');
                selectedSeats = [];
                updateSelectedSeatsDisplay();
                return;
            }
            
            // Deselect any previously selected seat
            document.querySelectorAll('.seat.selected').forEach(el => {
                el.classList.remove('selected');
            });
            
            // Select new seat
            seatElement.classList.add('selected');
            selectedSeats = [{
                id: seatId,
                type: seatType,
                price: seatType === 'vip' ? seatPrices.vip : seatPrices.normal
            }];
            
            updateSelectedSeatsDisplay();
        }

        // Update selected seats display
        function updateSelectedSeatsDisplay() {
            // Clear current display
            selectedSeatsContainer.innerHTML = '';
            
            if (selectedSeats.length === 0) {
                selectedSeatsContainer.innerHTML = '<p class="text-gray-400 text-center">Chưa có ghế nào được chọn</p>';
                totalPriceElement.textContent = '0 VND';
                checkoutBtn.disabled = true;
                return;
            }
            
            // Add selected seats
            let totalPrice = 0;
            selectedSeats.forEach(seat => {
                const seatElement = document.createElement('div');
                seatElement.className = 'flex justify-between items-center';
                seatElement.innerHTML = `
                    <span>${seat.id} (${seat.type === 'vip' ? 'VIP' : 'Thường'})</span>
                    <span class="font-medium">${seat.price.toLocaleString()} VND</span>
                `;
                selectedSeatsContainer.appendChild(seatElement);
                totalPrice += seat.price;
            });
            
            // Update total price
            totalPriceElement.textContent = `${totalPrice.toLocaleString()} VND`;
            checkoutBtn.disabled = false;
        }

        // Initialize checkout button
        checkoutBtn.addEventListener('click', () => {
            // Save selected seats to localStorage before checkout
            saveSelectedSeats();
            alert(`Bạn đã chọn ${selectedSeats.length} ghế với tổng giá ${totalPriceElement.textContent}. Chức năng thanh toán sẽ được thực hiện ở bước tiếp theo.`);
        });

        // Save selected seats to localStorage
        function saveSelectedSeats() {
            const customerName = document.getElementById('customer-name').value.trim();
            if (selectedSeats.length > 0 && customerName) {
                // Add booking to history
                const newBooking = {
                    name: customerName,
                    seat: selectedSeats[0].id,
                    type: selectedSeats[0].type,
                    price: selectedSeats[0].price,
                    movie: "Mưa Đỏ",
                    cinema: "Lotte Thanh Hóa",
                    date: "14/09/2025",
                    time: "14:15"
                };
                
                bookings.unshift(newBooking);
                localStorage.setItem('bookings', JSON.stringify(bookings));
                
                // Add selected seat to booked seats
                const newBookedSeats = [...bookedSeats, selectedSeats[0].id];
                localStorage.setItem('bookedSeats', JSON.stringify(newBookedSeats));
                
                // Clear current selection
                localStorage.removeItem('selectedSeats');
                selectedSeats = [];
                document.getElementById('customer-name').value = '';
                updateSelectedSeatsDisplay();
                updateBookedList();
                
                // Update UI to show booked seats
                document.querySelectorAll('.seat').forEach(seat => {
                    if (newBookedSeats.includes(seat.dataset.seat)) {
                        seat.classList.add('booked');
                        seat.classList.remove('selected');
                        seat.disabled = true;
                    }
                });
            } else if (!customerName) {
                alert("Vui lòng nhập tên người đặt");
            }
        }

        // Update booked list display
        function updateBookedList() {
            const bookedList = document.getElementById('booked-list');
            bookedList.innerHTML = '';
            
            if (bookings.length === 0) {
                bookedList.innerHTML = '<p class="text-gray-400 text-center">Chưa có đặt chỗ nào</p>';
                return;
            }
            
            bookings.slice(0, 5).forEach(booking => {
                const bookingElement = document.createElement('div');
                bookingElement.className = 'bg-gray-600 p-3 rounded-lg';
                bookingElement.innerHTML = `
                    <div class="flex justify-between">
                        <span class="font-medium">${booking.name}</span>
                        <span class="text-blue-400">${booking.seat}</span>
                    </div>
                    <div class="text-xs text-gray-400 mt-1">
                        ${booking.movie} • ${booking.cinema} • ${booking.date} ${booking.time}
                    </div>
                `;
                bookedList.appendChild(bookingElement);
            });
        }

        // Load selected seats from localStorage
        function loadSelectedSeats() {
            // All seats are available
            document.querySelectorAll('.seat').forEach(seat => {
                seat.classList.remove('booked');
                seat.disabled = false;
            });
        }

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDz9bw4JQ5ZQ1Q1Q1Q1Q1Q1Q1Q1Q1Q1Q1Q",
            authDomain: "bookve-mua-do.firebaseapp.com",
            projectId: "bookve-mua-do",
            storageBucket: "bookve-mua-do.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef1234567890abcdef"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Initialize page
        document.addEventListener('DOMContentLoaded', async () => {
            generateSeats();
            feather.replace();
            await loadBookedSeats();
            await updateBookedList();
        });

        // Load booked seats from Firestore
        async function loadBookedSeats() {
            try {
                const snapshot = await db.collection('bookings').get();
                bookedSeats = snapshot.docs.map(doc => doc.data().seat);
                updateSeatAvailability();
            } catch (error) {
                console.error("Error loading booked seats:", error);
            }
        }

        // Update seat availability based on booked seats
        function updateSeatAvailability() {
            document.querySelectorAll('.seat').forEach(seat => {
                if (bookedSeats.includes(seat.dataset.seat)) {
                    seat.classList.add('booked');
                    seat.classList.remove('selected');
                    seat.disabled = true;
                } else {
                    seat.classList.remove('booked');
                    seat.disabled = false;
                }
            });
        }

        // Save booking to Firestore
        async function saveSelectedSeats() {
            const customerName = document.getElementById('customer-name').value.trim();
            if (selectedSeats.length > 0 && customerName) {
                try {
                    const newBooking = {
                        name: customerName,
                        seat: selectedSeats[0].id,
                        type: selectedSeats[0].type,
                        price: selectedSeats[0].price,
                        movie: "Mưa Đỏ",
                        cinema: "Lotte Thanh Hóa",
                        date: "14/09/2025",
                        time: "14:15",
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    
                    // Add to Firestore
                    await db.collection('bookings').add(newBooking);
                    
                    // Update local state
                    bookings.unshift(newBooking);
                    bookedSeats.push(selectedSeats[0].id);
                    
                    // Clear current selection
                    selectedSeats = [];
                    document.getElementById('customer-name').value = '';
                    updateSelectedSeatsDisplay();
                    updateSeatAvailability();
                    await updateBookedList();
                    
                    alert("Đặt chỗ thành công!");
                } catch (error) {
                    console.error("Error saving booking:", error);
                    alert("Có lỗi xảy ra khi đặt chỗ. Vui lòng thử lại.");
                }
            } else if (!customerName) {
                alert("Vui lòng nhập tên người đặt");
            }
        }

        // Update booked list from Firestore
        async function updateBookedList() {
            try {
                const snapshot = await db.collection('bookings')
                    .orderBy('timestamp', 'desc')
                    .limit(5)
                    .get();
                
                bookings = snapshot.docs.map(doc => doc.data());
                
                const bookedList = document.getElementById('booked-list');
                bookedList.innerHTML = '';
                
                if (bookings.length === 0) {
                    bookedList.innerHTML = '<p class="text-gray-400 text-center">Chưa có đặt chỗ nào</p>';
                    return;
                }
                
                bookings.forEach(booking => {
                    const bookingElement = document.createElement('div');
                    bookingElement.className = 'bg-gray-600 p-3 rounded-lg';
                    bookingElement.innerHTML = `
                        <div class="flex justify-between">
                            <span class="font-medium">${booking.name}</span>
                            <span class="text-blue-400">${booking.seat}</span>
                        </div>
                        <div class="text-xs text-gray-400 mt-1">
                            ${booking.movie} • ${booking.cinema} • ${booking.date} ${booking.time}
                        </div>
                    `;
                    bookedList.appendChild(bookingElement);
                });
            } catch (error) {
                console.error("Error loading bookings:", error);
            }
        }
    </script>
</body>
</html>
